<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="partials/header :: header (Events)"></head>
<body>

<div th:replace="partials/navbar :: navbar"></div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-md-offset-3 text-center">
            <h1 class="homePageText">Create A New Event!</h1>
        </div>
    </div>
</div>

<div class="container eventContainer">
    <div class="row">
        <form class="form" th:action="@{/events/create}" method="POST" th:object="${event}">
            <label>Add Title
            <input type="text" th:field="*{title}" th:required="required" /></label> <br />
            <p th:if="${#fields.hasErrors('title')}" th:errors="*{title}" />
            <input type="date" name="startDate" th:required="required" />
            <!--<p th:if="${#fields.hasErrors('start_date')}" th:errors="*{start_date}" />-->
            <input type="time" name="startTime" />
            <span> to </span>
            <input type="time" name="endTime" />
            <input type="date" name="endDate" th:required="required"/>
            <label><input type="checkbox" name="allDay" id="allDay" checked="checked"/> All Day</label><br />
            <label><i class="fas fa-location-arrow"></i> Add Location
            <input type="text" th:field="*{location}" /> </label>
            <label><input type="checkbox" name="isAddress" id="isAddress" />Input Address?</label><br />
            <label class="addressStuff" for="address">Address: <input class="addressStuff" type="text" th:field="*{address}" id="address" name="address" /></label> <br class="addressStuff"/>
            <button class="addressStuff" type="button" id="addressButton">Check Address</button> <br class="addressStuff"/>
            <label><i class="fas fa-file-alt"></i> Add Description<br />
                <input type="text" th:field="*{description}"/></label><br/>
            <p th:if="${#fields.hasErrors('description')}" th:errors="*{description}" />
            <h1>Categories</h1>
            <div>
                <label th:each="category : ${categories}">
                    <input type="checkbox" th:field="*{categories}" th:value="${category.id}" /> <span class="categories" th:text="${category.name}"></span>
                </label>
            </div>

            <button>Submit</button>
        </form>

    </div>
</div>
<div class="container" id="mapContainer">
    <div class="mapBox">
        <div id="map"></div>
    </div>
</div>



<footer th:replace="partials/footer :: footer"></footer>
<script>
    "use strict";

    let lat = 29.4241219;
    let lng = -98.49362819999999;


    var map;
    var marker;
    function initMap() {
        var coords = {lat: lat, lng: lng};
        map = new google.maps.Map(document.getElementById('map'), {
            center: coords,
            zoom: 14
        });
        marker = new google.maps.Marker({
            position: coords,
            map: map
        });
    }

    $('#addressButton').click(function (){
        var address = document.getElementById("address").value;
        var geocoder = new google.maps.Geocoder();

        geocoder.geocode({"address": address}, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                lat = results[0].geometry.location.lat();
                lng = results[0].geometry.location.lng();
                $('#mapContainer').show();
                initMap();

            } else {

                alert('Geocoding was not successful - STATUS: ' + status);
            }

        });
    });
    $('#mapContainer').hide();

    $('.addressStuff').hide();
    $('#isAddress').click(()=> {
            $('#isAddress').attr('checked', (index, attr) => {
                return attr === "checked" ? null : "checked";
            });
            if($('#isAddress').attr('checked')) {
                $('.addressStuff').show();
            } else {
                $('.addressStuff').hide();
            }
    });




</script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfZSV1KZRKrRqegGDRMOme6uxQs56ltXc&amp;callback=initMap"></script>



</body>
</html>