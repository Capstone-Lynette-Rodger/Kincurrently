<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="partials/header :: header (Events)"></head>
<body>

<div th:replace="partials/navbar :: navbar"></div>

<div class="container eventContainer">
    <div class="row">
        <form class="form" th:action="@{/events/edit}" method="POST" th:object="${event}">
            <label>Title: </label>
            <input type="text" th:field="*{title}" th:value="${title}" th:required="required" /> <br />
            <p th:if="${#fields.hasErrors('title')}" th:errors="*{title}" />
            <label>Start Date: </label>
            <input type="date" name="startDate" th:required="required" /> <label>Start Time: </label>
            <!--<p th:if="${#fields.hasErrors('start_date')}" th:errors="*{start_date}" />-->
            <input type="time" name="startTime" /> <br />
            <label>End Date: </label>
            <input type="date" name="endDate" /> <label>End Time: </label>
            <input type="time" name="endTime" /> <br />
            <label>Location: </label>
            <input type="text" th:field="*{location}" th:value="${location}" /> <br />
            <label><input type="checkbox" name="isAddress" id="isAddress" />Input Address?</label><br />
            <label class="addressStuff" for="address">Address: <input class="addressStuff" type="text" th:field="*{address}" th:value="${address}" id="address" name="address" /></label> <br class="addressStuff"/>
            <button class="addressStuff" type="button" id="addressButton">Check Address</button> <br class="addressStuff"/>
            <label>Description: </label>
            <input type="text" th:field="*{description}" th:value="${description}" th:required="required" />
            <p th:if="${#fields.hasErrors('description')}" th:errors="*{description}" />
            <h1>Categories</h1>
            <div>
                <label th:each="category : ${categories}">
                    <input type="checkbox" th:field="*{categories}" th:value="${category.id}" /> <span class="categories" th:text="${category.name}"></span>
                </label>
            </div>
            <input type="hidden" th:field="*{id}" th:value="${id}" /> <br />

            <button>Submit Edits</button>
        </form>
        <form class="xs-offset-3 xs-col-6 center-block text-center" th:action="@{/events/delete}" th:method="post" th:object="${event}">
            <input type="hidden" th:field="*{id}" th:value="${id}" />
            <button id="delete">Delete</button>
        </form>
    </div>
</div>

<div th:if="${event.address}">
    <div th:if="${!event.address.equalsIgnoreCase('')}" class="container" id="mapContainer">
        <div class="mapBox">
            <div id="map"></div>
        </div>
    </div>
</div>


<footer th:replace="partials/footer :: footer"></footer>
<!--<div th:include="partials/googlemaps :: googlemaps"></div>-->

<script>
    "use strict";

    let lat = 29.4241219;
    let lng = -98.49362819999999;


    var map;
    var marker;
    function initMap() {
        var coords = {lat: lat, lng: lng};
        map = new google.maps.Map(document.getElementById('map'), {
            center: coords,
            zoom: 14
        });
        marker = new google.maps.Marker({
            position: coords,
            map: map
        });
    }


    $('#addressButton').click(function (){
        var address = document.getElementById("address").value;
        var geocoder = new google.maps.Geocoder();

        geocoder.geocode({"address": address}, function (results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                lat = results[0].geometry.location.lat();
                lng = results[0].geometry.location.lng();
                $('#mapContainer').show();
                initMap();

            } else {

                alert('Geocoding was not successful - STATUS: ' + status);
            }

        });
    });
    $('#mapContainer').hide();


    $('.addressStuff').hide();
    $('#isAddress').click(()=> {
        $('#isAddress').attr('checked', (index, attr) => {
            return attr === "checked" ? null : "checked";
        });
        if($('#isAddress').attr('checked')) {
            $('.addressStuff').show();
        } else {
            $('.addressStuff').hide();
        }
    });




</script>


<script th:src="@{https://maps.googleapis.com/maps/api/js(key=${event.getApi()})}"></script>

</body>
</html>