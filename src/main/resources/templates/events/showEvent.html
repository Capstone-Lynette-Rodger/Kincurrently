<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity4">
<head th:replace="partials/header :: header (Events)"></head>
<body>

<div th:replace="partials/navbar :: navbar"></div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-md-offset-3 text-center">
            <h1 class="homePageText">Check Out and Comment on A Single Event!</h1>
        </div>
    </div>
</div>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-md-offset-3 eventContainer">
            <h2 th:text="${event.title}"></h2>
            <p th:text="${event.description}"></p>
            <div><span th:each="category : ${event.categories}"><button class="btn btn-primary" th:text="${category.name}"></button></span></div>
            <div th:if="${event.user.id == #authentication.principal.id}">
                <a th:href="@{/events/{id}/edit(id=${event.id})}">Edit</a>
            </div>
            <div><input type="hidden" th:value="${event.address}" id="address" /></div>
            <!--<div th:if="${!event.address.equalsIgnoreCase('')}">-->
                <!--<img th:src="@{https://maps.googleapis.com/maps/api/staticmap(center=${event.address},markers='color:blue|'+ ${event.address} + '|',zoom=14,size='400x600',key='AIzaSyDfZSV1KZRKrRqegGDRMOme6uxQs56ltXc')}" alt="" />-->
            <!--</div>-->
        </div>
    </div>
</div>



<div th:if="${!event.address.equalsIgnoreCase('')}" class="container" id="mapContainer">
    <div class="mapBox">
        <div id="map"></div>
    </div>
</div>



<hr />

<div class="container">
    <h1>Comments</h1>
    <div class="row justify-content-center">
        <div class="col" th:each="eventComment : ${event.eventComments}">
            <h5 th:utext="${eventComment.commentBody}"></h5>
            <h5>Posted by: <span th:text="${eventComment.user.getUsername()}"></span></h5>
            <h5 th:if="${eventComment.user.id == #authentication.principal.id}">
                <a th:href="@{/events/comment/{id}/edit(id=${eventComment.id})}">Edit</a>
            </h5>
        </div>
    </div>
</div>


<div class="container eventContainer">
    <div class="row justify-content-center">
        <form class="text-center" th:action="@{/events/comment}" method="post" th:object="${eventComment}">
            <label class="titleLabel">Add Comment:</label> <br />
            <textarea class="createTitle" style="width: 550px; height: 300px;" th:field="*{commentBody}" ></textarea>
            <input type="hidden" name="eventId" th:value="${event.id}" />
            <br />
            <input type="submit" />
        </form>
    </div>
</div>



<footer th:replace="partials/footer :: footer"></footer>
<!--<div th:include="partials/googlemaps :: googlemaps"></div>-->


<script>
    "use strict";

    let lat = 29.4241219;
    let lng = -98.49362819999999;


    var map;
    var marker;
    function initMap() {
        var coords = {lat: lat, lng: lng};
        map = new google.maps.Map(document.getElementById('map'), {
            center: coords,
            zoom: 14
        });
        marker = new google.maps.Marker({
            position: coords,
            map: map
        });
    }

    $( window ).on( "load", function (){

        var address = document.getElementById("address").value;

        if (address !== "") {

            var geocoder = new google.maps.Geocoder();

            geocoder.geocode({"address": address}, function (results, status) {
                if (status == google.maps.GeocoderStatus.OK) {
                    lat = results[0].geometry.location.lat();
                    lng = results[0].geometry.location.lng();
                    $('#mapContainer').show();
                    initMap();

                } else {

                    alert('Geocoding was not successful - STATUS: ' + status);
                }

            });

        }
    });

</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfZSV1KZRKrRqegGDRMOme6uxQs56ltXc"></script>

</body>
</html>